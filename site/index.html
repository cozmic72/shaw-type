<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaw Type - Shavian Typing Practice</title>
    <link rel="icon" type="image/png" sizes="64x64" href="favicon-64x64.png?v={{FULL_VERSION}}">
    <link rel="icon" type="image/png" sizes="128x128" href="favicon-128x128.png?v={{FULL_VERSION}}">
    <link rel="icon" type="image/png" sizes="180x180" href="favicon-180x180.png?v={{FULL_VERSION}}">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon-192x192.png?v={{FULL_VERSION}}">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon-512x512.png?v={{FULL_VERSION}}">
    <link rel="shortcut icon" type="image/png" href="favicon.png?v={{FULL_VERSION}}">

    <!-- Apple Touch Icons for iOS home screen (transparent background for iOS auto-theming) -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png?v={{FULL_VERSION}}">
    <link rel="apple-touch-icon" sizes="192x192" href="apple-touch-icon-192x192.png?v={{FULL_VERSION}}">
    <link rel="stylesheet" href="virtual-keyboard.css?v={{FULL_VERSION}}">
    <link rel="stylesheet" href="style.css?v={{FULL_VERSION}}">

    <!-- Load translations synchronously before anything else -->
    <script>
        // Version for cache-busting
        const RESOURCE_VERSION = '{{FULL_VERSION}}';

        // Helper: Add version parameter to resource URLs (global)
        window.versionedUrl = function(url) {
            return `${url}?v=${RESOURCE_VERSION}`;
        };

        // Global translations object - loaded synchronously
        window.translations = {
            latin: null,
            shavian_british: null,
            shavian_american: null
        };

        // Load translations synchronously using XMLHttpRequest (blocking)
        function loadTranslationsSync() {
            const files = [
                { key: 'latin', url: 'translations_latin.json' },
                { key: 'shavian_british', url: 'translations_british.json' },
                { key: 'shavian_american', url: 'translations_american.json' }
            ];

            files.forEach(file => {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', versionedUrl(file.url), false); // false = synchronous
                xhr.send();
                if (xhr.status === 200) {
                    window.translations[file.key] = JSON.parse(xhr.responseText);
                } else {
                    console.error(`Failed to load ${file.url} - status: ${xhr.status}`);
                }
            });
        }

        loadTranslationsSync();
    </script>

</head>
<body>
    <div class="container">
        <div class="header-bar">
            <button class="back-btn hidden" id="backBtn" onclick="goHome()">‚Üê</button>
            <h1 id="title">Shaw Type</h1>
            <div class="burger-menu">
                <button class="burger-btn" onclick="toggleBurgerMenu()">‚ò∞</button>
                <div class="burger-dropdown" id="burgerDropdown">
                    <a id="menuAbout" href="#" onclick="openContentModal('about'); return false;">About</a>
                    <a id="menuKeyboards" href="#" onclick="openContentModal('keyboards'); return false;">Keyboards</a>
                    <a id="menuResources" href="#" onclick="openContentModal('resources'); return false;">Resources</a>
                    <a id="menuHighScores" href="#" onclick="openHighScores(); closeBurgerMenu(); return false;">Scores</a>
                    <a id="menuSettings" href="#" onclick="openSettings(); closeBurgerMenu(); return false;">Settings</a>
                </div>
            </div>
        </div>

        <div class="subtitle" id="mainSubtitle"></div>

        <!-- Home Screen -->
        <div class="home-screen" id="homeScreen">
            <button class="home-btn" id="play" onclick="startPlay()">Play</button>
            <button class="home-btn" id="practice" onclick="startPractice()">Practice</button>
            <button class="home-btn" id="settings" onclick="openSettings()">Settings</button>
        </div>

        <!-- Countdown Screen -->
        <div class="countdown-screen hidden" id="countdownScreen">
            <div class="countdown-text" id="countdownText"></div>
        </div>

        <!-- Game Content -->
        <div class="game-content hidden" id="gameContent">
        <div class="word-display">
            <div class="word-carousel">
                <div class="word-slot slot-0" id="wordSlot0"></div>
                <div class="word-slot slot-1" id="wordSlot1"></div>
                <div class="word-slot slot-2" id="wordSlot2"></div>
                <div class="word-slot slot-3" id="wordSlot3"></div>
            </div>
        </div>

        <div class="input-container">
            <input type="text" id="typingInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" onclick="activatePhysicalKeyboardMode()">
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-label" id="levelLabel">Level</div>
                <div class="stat-value" id="levelDisplay">1</div>
            </div>
            <div class="stat">
                <div class="stat-label" id="words">Words</div>
                <div class="stat-value" id="wordCount">0</div>
            </div>
            <div class="stat">
                <div class="stat-label" id="accuracy">Accuracy</div>
                <div class="stat-value" id="accuracyValue">100%</div>
            </div>
        </div>

        <div id="currentLessonInfo" style="display: none; text-align: left; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 13px; color: #666;">
            <strong id="currentLessonName"></strong>
        </div>

        </div> <!-- End game-content -->
    </div> <!-- End container -->

    <div class="copyright">
        @2025 joro.io
    </div>

    <!-- Practice/Learn Mode Lesson Completion Modal -->
    <div class="completion-modal" id="lessonCompletionModal">
        <div class="completion-content">
            <span class="modal-close" onclick="goHome()">&times;</span>
            <h2 id="lessonCompleteTitle">Lesson Complete!</h2>
            <div class="stat-row"><span id="accuracy_lesson">Accuracy:</span> <span id="lessonAccuracy">--</span></div>
            <div>
                <button id="continueThisLesson" onclick="continueLesson()">Keep practicing this lesson</button>
                <button id="nextLesson" onclick="nextLesson()" style="margin-left: 10px;">Next lesson</button>
                <button id="chooseDifferentLesson" onclick="chooseDifferentLesson()" style="margin-left: 10px; background: white; color: #667eea; border: 2px solid #667eea;">Choose Different Lesson</button>
            </div>
        </div>
    </div>

    <!-- Practice/Learn Mode Session Completion Modal -->
    <div class="completion-modal" id="sessionCompletionModal">
        <div class="completion-content">
            <span class="modal-close" onclick="goHome()">&times;</span>
            <h2 id="sessionCompleteTitle">Session Complete!</h2>
            <div class="stat-row"><span id="accuracy_session">Accuracy:</span> <span id="sessionAccuracy">--</span></div>
            <div>
                <button id="continueButton2" onclick="continueLesson()">Continue</button>
                <button id="chooseDifferentLesson2" onclick="chooseDifferentLesson()" style="margin-left: 10px; background: white; color: #667eea; border: 2px solid #667eea;">Choose Different Lesson</button>
            </div>
        </div>
    </div>

    <!-- Play Mode Completion Modal -->
    <div class="completion-modal" id="playCompletionModal">
        <div class="completion-content">
            <span class="modal-close" onclick="goHome()">&times;</span>
            <h2 id="playCompleteTitle">Congratulations!</h2>
            <div id="personalBestLabel" style="color: #28a745; font-weight: bold; margin-top: 10px; display: none;"></div>
            <div class="final-score" id="finalScore">--</div>
            <div class="stat-row"><span id="wpm">WPM:</span> <span id="finalWPM">--</span></div>
            <div class="stat-row"><span id="lettersPerMin">Letters/min:</span> <span id="finalLPM">--</span></div>
            <div class="stat-row"><span id="accuracy_final">Accuracy:</span> <span id="finalAccuracy">--</span></div>
            <div class="stat-row"><span id="levelReached">Level Reached:</span> <span id="finalLevel">--</span></div>
            <div id="levelStatsContainer" class="level-stats-container"></div>
            <div>
                <button id="playAgainBtn" onclick="playAgain()">Play Again</button>
            </div>
        </div>
    </div>

    <!-- High Scores Modal -->
    <div class="settings-modal" id="highScoresModal">
        <div class="settings-content">
            <span class="modal-close" onclick="closeHighScores()">&times;</span>
            <h2 id="scoresTitle">Scores</h2>
            <div id="highScoresContent" style="margin-top: 20px;">
                <!-- High scores will be populated here -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="home-btn" id="close" onclick="closeHighScores()" style="padding: 12px 40px; font-size: 16px;">Close</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <span class="modal-close" onclick="closeSettings()">&times;</span>
            <h2 id="settingsTitle">Settings</h2>

            <div class="settings-option">
                <label id="dialectLabel" style="display: block; margin-bottom: 10px; color: #666; font-weight: normal;">
                    Choose spelling
                </label>
                <div style="display: flex; gap: 20px;">
                    <label style="cursor: pointer;">
                        <input type="radio" name="dialectSettings" value="gb" checked onchange="onDialectChangeSettings()" style="margin-right: 8px;">
                        <span id="dialectBritish">British</span>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="dialectSettings" value="us" onchange="onDialectChangeSettings()" style="margin-right: 8px;">
                        <span id="dialectAmerican">American</span>
                    </label>
                </div>
            </div>

            <div class="settings-option">
                <label style="display: block; margin-bottom: 10px; color: #666; font-weight: normal;" id="keyboardLayout">
                    Keyboard Layout
                </label>
                <select id="layoutSelectSettings" onchange="onLayoutChangeSettings()" style="width: 100%; padding: 8px; font-size: 16px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <option id="layoutImperial" value="imperial">Shaw Imperial</option>
                    <option id="layoutIGC" value="igc">Imperial Good Companion</option>
                    <option id="layoutQwerty" value="qwerty">Shaw QWERTY</option>
                    <option id="layout2layer" value="2layer">Shaw 2-layer (shift)</option>
                    <option id="layoutJafl" value="jafl">Shaw-JAFL</option>
                </select>
            </div>

            <div class="settings-option" id="ligatureSettingOption">
                <label>
                    <input type="checkbox" id="ligatureToggleSettings" onchange="onLigatureToggleSettings()">
                    <span id="ligatures">Automatic ligatures (êë©+êëÆ‚Üíêëº, êëò+êëµ‚Üíêëø)</span>
                </label>
            </div>

            <div class="settings-option">
                <label>
                    <input type="checkbox" id="virtualKeyboardToggle" onchange="toggleVirtualKeyboard()">
                    <span id="showVirtualKeyboard">Show virtual keyboard</span>
                </label>
            </div>

            <div class="settings-option">
                <label>
                    <input type="checkbox" id="shavianUIToggle" onchange="toggleShavianUI()">
                    <span id="displayShavian">Display UI in Shavian</span>
                </label>
            </div>

            <div class="settings-option">
                <label style="display: block; margin-bottom: 10px; color: #666; font-weight: normal;" id="levelCountLabel">
                    Play Mode Level Count
                </label>
                <select id="levelCountSelect" onchange="onLevelCountChange()" style="width: 100%; padding: 8px; font-size: 16px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <option id="levelCount3" value="3">3 levels (15 words)</option>
                    <option id="levelCount6" value="6" selected>6 levels (30 words)</option>
                    <option id="levelCount10" value="10">10 levels (50 words)</option>
                </select>
            </div>

        </div>
    </div>

    <!-- Content Modal -->
    <div class="settings-modal" id="contentModal">
        <div class="settings-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <span class="modal-close" onclick="closeContentModal()">&times;</span>
            <div id="contentModalBody" style="margin-top: 20px;">
                Loading...
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <!-- Splash Screen (What's New) -->
    <div class="settings-modal" id="splashModal">
        <div class="settings-content" style="max-width: 600px;">
            <div id="splashContent" style="margin: 20px 0;">
                Loading...
            </div>

            <button id="continueButton" class="settings-close-btn" onclick="closeSplashModal()" style="margin-top: 15px; width: 100%;">Continue</button>

            <div style="margin: 15px 0; text-align: center;">
                <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="dontShowSplash" style="cursor: pointer;">
                    <span id="dontShowAgain" style="color: #666; font-size: 14px;">Don't show this again</span>
                </label>
            </div>
        </div>
    </div>

    <!-- First-Time Setup Dialog -->
    <div class="settings-modal" id="setupModal">
        <div class="settings-content" style="max-width: 500px;">
            <h2 id="setupTitle">Get Started</h2>
            <p id="setupSubtitle" style="margin: 15px 0; color: #666;">Choose your keyboard layout and spelling preference:</p>

            <div class="settings-option">
                <label id="setupKeyboardLayoutLabel" style="display: block; margin-bottom: 10px; color: #666; font-weight: normal;">
                    Keyboard Layout
                </label>
                <select id="layoutSelectSetup" onchange="onLayoutChangeSetup()" style="width: 100%; padding: 8px; font-size: 16px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <option value="imperial">Shaw Imperial</option>
                    <option value="igc">Imperial Good Companion</option>
                    <option value="qwerty">Shaw QWERTY</option>
                    <option value="2layer">Shaw 2-layer (shift)</option>
                    <option value="jafl">Shaw-JAFL</option>
                </select>
            </div>

            <div class="settings-option">
                <label id="setupDialectLabel" style="display: block; margin-bottom: 10px; color: #666; font-weight: normal;">
                    Choose spelling
                </label>
                <div style="display: flex; gap: 20px;">
                    <label style="cursor: pointer;">
                        <input type="radio" name="dialectSetup" value="gb" checked onchange="onDialectChangeSetup()" style="margin-right: 8px;">
                        <span id="setupDialectBritish">British</span>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="dialectSetup" value="us" onchange="onDialectChangeSetup()" style="margin-right: 8px;">
                        <span id="setupDialectAmerican">American</span>
                    </label>
                </div>
            </div>

            <div class="settings-option">
                <label style="cursor: pointer;">
                    <input type="checkbox" id="virtualKeyboardToggleSetup" style="margin-right: 8px;">
                    <span id="setupVirtualKeyboard">Show virtual keyboard</span>
                </label>
            </div>

            <p id="setupNote" style="margin: 20px 0; color: #999; font-size: 14px; font-style: italic;">
                Don't worry too much. This choice, and more besides, can be changed later in settings.
            </p>

            <button id="setupStartBtn" class="settings-close-btn" onclick="closeSetupModal()" style="margin-top: 15px; width: 100%;">Start Practicing!</button>
        </div>
    </div>

    <!-- Lesson Selector Modal -->
    <div class="settings-modal" id="lessonModal">
        <div class="settings-content" style="max-width: 500px;">
            <span class="modal-close" onclick="closeLessonModal()">&times;</span>
            <h2 id="lessonModalTitle">Choose a Lesson</h2>
            <p id="lessonModalSubtitle" style="margin: 15px 0; color: #666;">Select a lesson to practice:</p>

            <div id="lessonList" style="margin: 20px 0; max-height: 400px; overflow-y: auto;">
                <!-- Lessons will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Virtual Keyboard Container (loaded dynamically) -->
    <div id="virtualKeyboardContainer"></div>

    <!-- Load utilities first (debug, isMobileDevice, etc.) -->
    <script src="utils.js?v={{FULL_VERSION}}"></script>

    <!-- Load virtual keyboard before main script -->
    <script src="virtual-keyboard.js?v={{FULL_VERSION}}"></script>

    <!-- Load game state class before main script -->
    <script src="game-state.js?v={{FULL_VERSION}}"></script>

    <script src="main.js?v={{FULL_VERSION}}"></script>
</body>
</html>
